class Step{constructor(e,t){this.avenue=e,this.title="",this.content=$("<div>"),this.options=$('<div class="btn-group" role="group" aria-label="options">'),t.title&&this.setTitle(t.title),t.content&&this.setContent(t.content,this.content),t.steps&&this.setOptions(t.steps)}setTitle(e){this.title=e}getTitle(){return this.title}setContent(e,t){switch(typeof e){case"string":this.appendContentText(e,t);break;case"object":if(Array.isArray(e)){this.appendContentArray(e,t);break}this.appendContentObject(e,t)}}setOptions(e){for(let t of e){let e="";t.title&&(e=t.title),t.button&&(e=t.button),this.options.append($('<a href="'+this.avenue.getStepPath(t)+'" class="btn btn-outline-dark">').text(e))}}appendContentArray(e,t){for(let n of e)this.setContent(n,t)}appendContentText(e,t){e=e.replace(/`([^`]*)`/gi,"<code>$1</code>"),t.append($("<p>").append(e))}appendContentObject(e,t){switch(e.type){case"code":this.appendContentCode(e.content,t);break;case"button":this.appendContentButton(e.text,e.target,t);break;case"box":this.appendContentBox(e.content,t);break;default:this.appendContentType(e.content,e.type,t)}}appendContentCode(e,t){"object"==typeof e&&(e=JSON.stringify(e,null,4)),t.append($('<div class="card bg-dark text-left m-2">').append($('<div class="card-body">').append($('<pre class="m-0">').append($('<code class="text-white">').text(e)))))}appendContentButton(e,t,n){n.append($('<a href="'+t+'" class="btn btn-outline-dark">').text(e))}appendContentBox(e,t){var n=$('<div class="card-body">');this.setContent(e,n),t.append($('<div class="card m-2">').append(n))}appendContentType(e,t,n){n.append($("<"+t+">").append(e))}}class Webpage{constructor(e){this.avenue=e,this.path=window.location.href.split("#")[1],void 0===this.path&&this.goToPath("demo"),"/"===this.path.substr(0,1)&&(this.path=this.path.substr(1,this.path.length))}goToPath(e){this.path=e,window.location.replace(this.generatePath(this.path))}generatePath(e){return window.location.origin+window.location.pathname+"#/"+e}generateParentPath(){let e=window.location.hash.split("/");"#"===e[0]&&e.shift();let t=e.shift();if(!e.length)return;e.pop();let n=window.location.origin+window.location.pathname+"#/"+t+"/";for(let t of e)n+=t+"/";return"/"==n.charAt(n.length-1)&&(n=n.substring(0,n.length-1)),n}displayToolbar(e,t){let n=this.generateParentPath();if($("#back").hide(),$("#home").hide(),e.buttons)for(let a of e.buttons)switch(a){case"back":n&&$("#back").show().attr("href",n);break;case"home":n&&$("#home").show().attr("href",this.generatePath(t))}}displayStep(e){document.title=e.title,$("#step-title").empty().html(e.title),$("#step-content").empty().html(e.content),$("#step-options").empty().html(e.options)}generateUrlForAvenue(e){return this.generatePath(e)}generateUrlForReference(e){this.avenue.getStepByReference(e);let t=this.avenue.findPathForReference(e);return this.generatePath(this.avenue.name+t)}generateRelativeUrlForStep(e){let t=this.generateSlug(e);return this.generatePath(this.path+"/"+t)}generateSlug(e){return e.toString().toLowerCase().normalize("NFD").trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")}}class Avenue{constructor(){this.webpage=new Webpage(this),this.getAvenue()}getAvenue(){var e=this.webpage.path;e.includes("/")&&(e=e.split("/")[0]);var t=this;$.getJSON("avenues/"+e+".json",(function(n){t.name=e,t.avenue=n,t.setStepFromPath(),t.webpage.displayToolbar(t.avenue,t.name),t.webpage.displayStep(t.step)}))}setStepFromPath(){let e=this.webpage.path;e.includes("/")||(this.step=new Step(this,this.avenue));let t=e.split("/");t.shift();let n=this.getStepThroughSlugStack(t,this.avenue);void 0===n&&this.webpage.goToPath(this.name),this.step=new Step(this,n)}getStepPath(e){return e.goto?this.webpage.generateUrlForReference(e.goto):e.avenue?this.webpage.generateUrlForAvenue(e.avenue):e.url?e.url:this.webpage.generateRelativeUrlForStep(e.title)}getStepThroughSlugStack(e,t){if(0===e.length)return t;let n=e.shift();for(let a of t.steps){if(a.goto&&(a=this.getStepByReference(a.goto)),this.webpage.generateSlug(a.title)===n)return this.getStepThroughSlugStack(e,a)}}findPathForReference(e,t="",n=""){if(""===t?t=this.avenue:n+="/"+this.webpage.generateSlug(t.title),t.reference===e)return n;if("home"===e)return n;if(!t.steps)return!1;for(let a of t.steps){if(!a.title)continue;let t=this.findPathForReference(e,a,n);if(t)return t}return!1}getStepByReference(e,t=this.avenue){if(t.reference===e)return t;if(t.steps)for(let a of t.steps){var n=this.getStepByReference(e,a);if(n)return n}}}$((function(){new Avenue;$(window).on("hashchange",(function(){location.reload()}))}));